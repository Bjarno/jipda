<html>

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<link rel="stylesheet" href="jipda.css" type="text/css" media="all"/> 
	<title>JIPDA</title>
	<script type="text/javascript" src="../lib/esprima.js"></script>
	<script type="text/javascript" src="../common.js"></script>
	<script type="text/javascript" src="../lattice/lattice.js"></script>
	<script type="text/javascript" src="../lattice/lattice1.js"></script>
	<script type="text/javascript" src="../lattice/setLattice.js"></script>
	<script type="text/javascript" src="../address/address.js"></script>
	<script type="text/javascript" src="../address/tagAg.js"></script>
	<script type="text/javascript" src="../benv/defaultBenv.js"></script>
	<script type="text/javascript" src="../ast.js"></script>
	<script type="text/javascript" src="../store.js"></script>
	<script type="text/javascript" src="../eval.js"></script>
	<script type="text/javascript" src="../jipda/jipda.js"></script>
	<script type="text/javascript" src="lib/jquery-1.7.2.min.js"></script>
	<script type="text/javascript" src="lib/ace/ace.js"></script>
	<script type="text/javascript" src="lib/viz.js"></script>
	<script type="text/javascript" src="vizgraph.js"></script>
	<script type="text/javascript">

	// define print method for JIPDA
   var print = function () { console.log(Array.prototype.slice.call(arguments).join(" ")) }		
	var editor;
	 
	function doIt()
	{
		$("#resultValue").empty();
		$("#graph").empty();
	  var src = editor.getSession().getValue();
    var ast = Ast.createAst(src);
    var lat = new Lattice1();
    //var lat = new SetLattice(3);
    var result = BOT;
    var c = Jipda.context({p: lat, a: tagAg});
    c.e.haltKont =
      function (value, store)
      {
        result = result.join(value);
        return [];
      }
    var state = Jipda.inject(ast, c);
    var jipda = Jipda.run(state, c);
		$("#resultValue").text(result);
    var etgEdges = jipda.dsg.etg.edges;
    var ecgEdges = jipda.dsg.ecg.edges;
    
    etgEdges.forEach(function (edge)
        {
      		edge.source.ss = Jipda.retrospectiveStack(edge.source, jipda.dsg.etg, jipda.dsg.ecg);
      		edge.target.ss = Jipda.retrospectiveStack(edge.target, jipda.dsg.etg, jipda.dsg.ecg);
        });
    
		//drawLinks(etgEdges.concat(ecgEdges), "#graph");
		drawLinks(etgEdges, "#graph");
	}
		
	$(function ()
	{
	  editor = ace.edit("editor");
	  editor.getSession().setMode("ace/mode/javascript");
	})
		
	</script>
</head>

<body>
	<div id="editor" style="width: 640px; height: 480px;"></div>
	<div id="manip" style="">
		<button id="eval" name="eval" onClick="doIt()">Eval</button>
		<span id="resultValue"></span>
	</div>
	<div id="graph"/>
</body>

</html>
